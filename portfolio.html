<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Joe Brighter - Portfolio</title>
        <link rel="stylesheet" href="portfolioStyle.css">
        <script src="https://kit.fontawesome.com/6c1c3d0aa2.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div id="header">
            <div class="container">
                <nav>
                    <p id="logo" class="noselect">
                        <span id="firstInitial" class="logoMainText">J</span><span class="logoSubText">oe&nbsp;</span>
                        <span id="secondInitial" class="logoMainText">B</span><span class="logoSubText">righter</span>
                    </p>
                    <!--<img src="images/logo.png" class="logo">-->
                    <ul id="menu" class="noselect">
                        <li><a href="index.html">Home</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div id="portfolio">
            <div class="container">
                <h1 class="sub-title noselect">My Projects</h1>


                <div class="search-container">
                    <!-- Input and Search Button Group (Left side) -->
                    <div class="search-field-group">
                        <input id="search-input" type="text" placeholder="Search projects..." class="search-input">
                        <button class="search-button">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                    <!-- Sort Buttons Group (Right side) -->
                    <div class="sort-buttons">
                        <button class="sort-button active" data-sort="desc">Newest First</button>
                        <button class="sort-button" data-sort="asc">Oldest First</button>
                    </div>
                </div>
                <div class="work-list" id="work-list">
                </div>
            </div>
            <div class="copyright">
                <p>Copyright Â© Joe Brighter. Design inspired by @GreatStack on Youtube</p>
            </div>
        </div>

        <script src="logoScript.js"></script>
        <script src="portfolioScript.js"></script>

        <script>
            
            var fullProjectCache;
            var partialProjectCache;
            var activeSort = "desc";

            fetch('./portfolio.json')
                .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json(); // Parse the JSON data from the response
                })
                .then(data => {
                // 'data' now contains the parsed JSON object
                fullProjectCache = data;
                partialProjectCache = data;
                displayProjects(data, "desc", 0);
                })
                .catch(error => {
                console.error('Error fetching or parsing JSON:', error);
                });


            document.addEventListener('DOMContentLoaded', () => {
                const sortButtons = document.querySelectorAll('.sort-button');
                const searchInput = document.getElementById('search-input');
                const workList = document.getElementById("work-list");

                function handleSortClick(event) {
                    // Using 'this' (the button element itself)
                    const clickedButton_this = this;

                    // Get the sorting direction (e.g., 'asc' or 'desc')
                    const sortDirection = clickedButton_this.getAttribute('data-sort'); 
                    
                    // Remove 'active' class from all buttons
                    sortButtons.forEach(button => {
                        button.classList.remove('active');
                    });
                    
                    // Add 'active' class to the button that was just clicked
                    clickedButton_this.classList.add('active');

                    // Clear work-list
                    workList.innerHTML = "";

                    // change active sort
                    activeSort = sortDirection;

                    // Display
                    displayProjects(partialProjectCache, sortDirection, 0);

                }

                function filterProjects(searchTerm) {
                    const term = searchTerm.toLowerCase().trim();
                    
                    // Show all if search box is empty
                    if (term === "") {
                        partialProjectCache = fullProjectCache; 
                    }


                    //return projectData.filter(project => {
                    partialProjectCache = fullProjectCache.filter(project => {
                        // Check Title
                        const titleMatch = project.title.toLowerCase().includes(term);

                        // Check Description
                        const descriptionMatch = project.description.toLowerCase().includes(term);

                        // Check Tags (using .some() to check if ANY tag includes the term)
                        const tagsMatch = project.tags.some(tag => tag.toLowerCase().includes(term));

                        // Return true if any field matches the search term
                        return titleMatch || descriptionMatch || tagsMatch;
                    });
                }


                searchInput.addEventListener('input', (event) => {
                    const searchTerm = event.target.value;
                    filterProjects(searchTerm);
                    workList.innerHTML = "";
                    displayProjects(partialProjectCache, activeSort, 0);
                });

                sortButtons.forEach(button => {
                    button.addEventListener('click', handleSortClick);
                });
            });
        </script>

    </body>
</html>